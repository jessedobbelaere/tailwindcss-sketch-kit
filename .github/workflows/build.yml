name: Build

# Only execute if our Sketch file has changed
on:
  push:
    branches:
      - master
    paths:
      - "**.sketch"

jobs:
  generate-assets:
    runs-on: "macos-latest"
    steps:
      - uses: actions/checkout@v2
      - uses: oleksiyrudenko/gha-git-credentials@v1
        with:
          token: "${{ secrets.GITHUB_TOKEN }}"
      - name: Download & Install Sketch
        run: |
          curl -OL https://sketch.com/download/sketch.zip
          unzip sketch.zip
      - name: Install Inter font
        run: |
          curl -L -o Inter.zip https://github.com/rsms/inter/releases/download/v3.13/Inter-3.13.zip
          unzip Inter.zip
          cp Inter\ Desktop/*.otf /Library/Fonts/
      - name: Cleanup assets
        run: rm -rf images/* Tailwind\ CSS.pdf || true
      - name: Generate artboard previews with Sketchtool
        run: Sketch.app/Contents/Resources/sketchtool/bin/sketchtool export artboards --output=images --formats=png --scales=2 *.sketch
      - name: Generate a page preview with Sketchtool
        run: Sketch.app/Contents/Resources/sketchtool/bin/sketchtool export preview --output=images --filename="preview.png" --max-size=2000 *.sketch
      - name: Generate PDF page export with Sketchtool
        run: Sketch.app/Contents/Resources/sketchtool/bin/sketchtool export pages --item="Tailwind CSS" --formats=pdf --scales=2 *.sketch
      - name: Push assets to git
        run: |
          ls -al images/
          git add images/* Tailwind\ CSS@2x.pdf
          git commit -m "ðŸŽ¨ Update preview assets" && git push
